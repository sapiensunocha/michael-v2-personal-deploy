import fs from "fs/promises"; import path from "path"; import { fileURLToPath } from "url"; import fetch from "node-fetch"; import dotenv from "dotenv"; dotenv.config(); const __dirname = path.dirname(fileURLToPath(import.meta.url)); async function checkRedux() { try { console.log("Simulating Redux state population in src/components/Map/index.tsx..."); let disasterData = []; const filePath = path.resolve(__dirname, "src/data/disasterData.json"); try { disasterData = JSON.parse(await fs.readFile(filePath, "utf8")); } catch (e) { console.error("Error loading disasterData.json:", e.message); } const apiUrl = process.env.NEXT_PUBLIC_NASA_API_URL || "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson"; try { const res = await fetch(apiUrl); if (!res.ok) throw new Error(`HTTP ${res.status}`); const geojson = await res.json(); const apiData = geojson.features.map(f => ({ id: f.id, latitude: f.geometry.coordinates[1], longitude: f.geometry.coordinates[0], magnitude: f.properties.mag, time: f.properties.time })); disasterData = [...disasterData, ...apiData]; } catch (e) { console.error("Error fetching USGS API:", e.message); } const visibleDisasters = disasterData.filter(d => d.magnitude > 2.5 && d.time >= Date.now() - 7 * 24 * 60 * 60 * 1000 && typeof d.latitude === "number" && !isNaN(d.latitude) && typeof d.longitude === "number" && !isNaN(d.longitude)); console.log("visibleDisasters count:", visibleDisasters.length); if (visibleDisasters.length === 0) console.log("ERROR: No data in visibleDisasters. Check Redux dispatch in src/app/map/page.tsx or useSelector in src/components/Map/index.tsx."); else console.log("visibleDisasters sample:", visibleDisasters.slice(0, 2)); } catch (e) { console.error("Unexpected error:", e.message); } } checkRedux();
